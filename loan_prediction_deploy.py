# -*- coding: utf-8 -*-
"""loan_prediction_deploy.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1mmo7cVZJghd1IS1DPjr0nD0YWJTGd_iw
"""

import streamlit as st
import pandas as pd
import pickle
import os

st.title("Loan Prediction App")

# ---------- DEBUG: Show Files ----------
st.write("Current Directory:", os.getcwd())
st.write("Files in Directory:", os.listdir())

# ---------- FILE PATHS ----------
model_path = "loan_prediction_model.pkl"
encoder_path = "label_encoder.pkl"

# ---------- CHECK FILES ----------
if not os.path.exists(model_path):
    st.error("❌ Model file NOT FOUND!")
    st.stop()

if not os.path.exists(encoder_path):
    st.error("❌ Encoder file NOT FOUND!")
    st.stop()

# ---------- LOAD FILES SAFELY ----------
try:
    with open(model_path, "rb") as f:
        model = pickle.load(f)
except Exception as e:
    st.error(f"❌ Model loading failed: {e}")
    st.stop()

try:
    with open(encoder_path, "rb") as f:
        encoders = pickle.load(f)
except Exception as e:
    st.error(f"❌ Encoder loading failed: {e}")
    st.stop()

# ---------- USER INPUT ----------
gender = st.selectbox("Gender", ["Male", "Female"])
married = st.selectbox("Married", ["Yes", "No"])
education = st.selectbox("Education", ["Graduate", "Not Graduate"])
self_employed = st.selectbox("Self Employed", ["Yes", "No"])
applicant_income = st.number_input("Applicant Income")
loan_amount = st.number_input("Loan Amount")
property_area = st.selectbox("Property Area", ["Urban", "Semiurban", "Rural"])

# ---------- PREDICT ----------
if st.button("Predict"):

    input_dict = {
        "Gender": gender,
        "Married": married,
        "Education": education,
        "Self_Employed": self_employed,
        "ApplicantIncome": applicant_income,
        "LoanAmount": loan_amount,
        "Property_Area": property_area
    }

    input_df = pd.DataFrame([input_dict])

    # Apply encoding safely
    for col in encoders:
        if col in input_df.columns:
            input_df[col] = encoders[col].transform(input_df[col])

    input_df = input_df[model.feature_names_in_]

    prediction = model.predict(input_df)

    if prediction[0] == 1:
        st.success("Loan Approved ✅")
    else:
        st.error("Loan Rejected ❌")
